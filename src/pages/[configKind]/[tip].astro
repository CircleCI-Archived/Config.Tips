---
import type { InferGetStaticPropsType } from 'astro';
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import CodeWindow from '../../components/CodeWindow/CodeWindow.astro';

export async function getStaticPaths() {
  const configKinds = await getCollection("configKinds");
  const tips = await getCollection("tips");
  return tips.map(tip => {
    const configKind = configKinds.find(kind => kind.id === tip.data.kind.id)
    if (!configKind) {
      throw new Error(`Config kind not found for tip ${tip.id}`)
    }
    return {
      params: {
        configKind: configKind.id,
        tip: tip.slug
      },
      props: {
        configType: configKind.data,
        title: tip.data.title,
        description: tip.data.description,
        body: tip.body,
        snippet: tip.data.snippet,
        lang: configKind.data.snippet.lang,
        slug: tip.slug,
      }
    }
  })
}
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { configType, title, description, body, snippet, lang, slug } = Astro.props;
---
<Layout title={`Config.Tips - ${configType.name}: ${title}`} slug={slug} description={description}>
		<div>
      <div>
        <h1>{title}</h1>
        <p>{body}</p>
      </div>
      <div>
        <CodeWindow snippet={snippet} lang={lang} filePath={configType.snippet.filePath} />
      </div>
    </div>
</Layout>